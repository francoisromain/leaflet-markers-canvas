!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("leaflet")):"function"==typeof define&&define.amd?define(["leaflet"],e):e((t||self).L)}(this,function(n){"use strict";(n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n).MarkersCanvas=n.Layer.extend({_map:null,_canvas:null,_context:null,_markers:{},_icons:{},addTo:function(t){return t.addLayer(this),this},getBounds:function(){var t,e=new n.LatLngBounds;for(t in this._markers)e.extend(this._markers[t].getLatLng());return e},addMarker:function(t,e){void 0===e&&(e=!0);var i="markerPane"!==t.options.pane,s=!t.options.icon;i||s?console.error(i?"This is not a marker":"This marker has no icon",t):(t._map=this._map,this._markers[n.Util.stamp(t)]=t,e&&this._isMarkerVisible(t)&&this._drawMarker(t))},removeMarker:function(t,e){void 0===e&&(e=!0),delete this._markers[n.Util.stamp(t)],this._isMarkerVisible(t)&&e&&this.redraw()},initialize:function(t){n.Util.setOptions(this,t)},onAdd:function(t){this._map=t,this._initCanvas(),this.getPane().appendChild(this._canvas),t.on("moveend",this._reset,this),t.on("resize",this._reset,this),t.on("click",this._fire,this),t.on("mousemove",this._fire,this),t._zoomAnimated&&t.on("zoomanim",this._animateZoom,this)},onRemove:function(t){this.getPane().removeChild(this._canvas),t.off("click",this._fire,this),t.off("mousemove",this._fire,this),t.off("moveend",this._reset,this),t.off("resize",this._reset,this),t._zoomAnimated&&t.off("zoomanim",this._animateZoom,this)},setOptions:function(){return this},_initCanvas:function(){var t=this._map.getSize(),e=t.x,t=t.y,i=this._map.options.zoomAnimation&&n.Browser.any3d;this._canvas=n.DomUtil.create("canvas","leaflet-markers-canvas-layer leaflet-layer"),this._canvas.width=e,this._canvas.height=t,this._context=this._canvas.getContext("2d"),n.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(i?"animated":"hide"))},_drawMarker:function(t){var e,a=this,o=t.options.icon.options.iconUrl,i=t.getLatLng(),i=this._map.latLngToContainerPoint(i),s=i.x,i=i.y;t.image?this._drawImage(t,{x:s,y:i}):this._icons[o]?(t.image=this._icons[o].image,this._icons[o].isLoaded?this._drawImage(t,{x:s,y:i}):this._icons[o].elements.push({marker:t,x:s,y:i})):((e=new Image).src=o,t.image=e,this._icons[o]={image:e,isLoaded:!1,elements:[{marker:t,x:s,y:i}]},e.onload=function(){a._icons[o].isLoaded=!0;for(var t=a._icons[o].elements,e=0;e<t.length;e++){var i=t[e],s=i.marker,n=i.x,i=i.y;a._drawImage(s,{x:n,y:i})}})},_drawImage:function(t,e){var i=e.x,e=e.y,s=t.options.icon.options,n=s.rotationAngle,a=s.iconAnchor,s=s.iconSize,n=n||0;this._context.save(),this._context.translate(i,e),this._context.rotate(n*Math.PI/180),this._context.drawImage(t.image,-a[0],-a[1],s[0],s[1]),this._context.restore()},_getMarkerPxBounds:function(t){var e=t.getLatLng(),e=this._map.latLngToContainerPoint(e),i=e.x,e=e.y,t=t.options.icon.options,s=t.iconSize,t=t.iconAnchor;return n.bounds([i-t[0],e-t[1]],[i+s[0]-t[0],e+s[1]-t[1]])},_getMarkerLatLngBounds:function(t){var t=this._getMarkerPxBounds(t),e=t.min,t=t.max;return n.latLngBounds(this._map.containerPointToLatLng(e),this._map.containerPointToLatLng(t))},_isMarkerVisible:function(t){return!!this._map&&this._map.getBounds().overlaps(this._getMarkerLatLngBounds(t))},redraw:function(){if(this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._map)for(var t in this._markers){t=this._markers[t];this._isMarkerVisible(t)&&this._drawMarker(t)}},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]),t=(n.DomUtil.setPosition(this._canvas,t),this._map.getSize()),e=t.x,t=t.y;this._canvas.width=e,this._canvas.height=t,this.redraw()},_fire:function(t){if(this._markers){var e,i;for(i in this._markers){var s=this._markers[i];if(this._getMarkerPxBounds(s).contains(t.containerPoint)){e=s;break}}e?(this._map._container.style.cursor="pointer","click"===t.type&&e.listens("click")&&e.fire("click"),"mousemove"===t.type&&(this._mouseOverMarker&&this._mouseOverMarker!==e&&this._mouseOverMarker.listens("mouseout")&&this._mouseOverMarker.fire("mouseout"),this._mouseOverMarker&&this._mouseOverMarker===e||(this._mouseOverMarker=e).listens("mouseover")&&e.fire("mouseover"))):(this._map._container.style.cursor="","mousemove"===t.type&&this._mouseOverMarker&&(this._mouseOverMarker.listens("mouseout")&&this._mouseOverMarker.fire("mouseout"),delete this._mouseOverMarker))}},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),t=this._map._latLngBoundsToNewLayerBounds(this._map.getBounds(),t.zoom,t.center).min;n.DomUtil.setTransform(this._canvas,t,e)}})});
